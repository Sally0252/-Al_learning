{% extends "core/layout.html" %}

{% block content %}

<style>
    /* æ–°å¢æ ·å¼ï¼šç”¨äºå®ç°ä¸¤æ å¸ƒå±€ */
    #learning-container {
        display: flex;
        min-height: 80vh; /* ç¡®ä¿å†…å®¹åŒºè¶³å¤Ÿé•¿ */
    }
    #sidebar {
        width: 300px;
        background-color: #f8f8f8;
        padding: 20px;
        border-right: 1px solid #ddd;
        /* ä¿æŒç›®å½•ä½ç½®å›ºå®šï¼Œå¦‚æœéœ€è¦ */
        /* position: sticky; top: 0; height: 100vh; */
    }
    #main-area {
        flex-grow: 1;
        padding: 30px;
        display: flex;
        flex-direction: column; /* å‚ç›´æ’åˆ—å†…å®¹å’Œè¾“å…¥åŒº */
    }
    .module-item {
        margin-bottom: 5px;
        padding: 8px 10px;
        border-radius: 4px;
        font-size: 0.95em;
    }
    .module-item a {
        text-decoration: none;
        color: #333;
        display: block;
    }
    .module-item.current {
        background-color: #d1e7ff; /* å½“å‰æ¨¡å—é«˜äº® */
        font-weight: bold;
        border-left: 4px solid #007bff;
    }
    .module-item.completed a {
         color: #6c757d; /* å·²å®Œæˆå˜ç° */
    }
    /* å­¦ä¹ å†…å®¹åŒºæ ·å¼ */
    #learning-content-display {
        flex-grow: 1; /* å æ®å¤§éƒ¨åˆ†ç©ºé—´ */
        margin-bottom: 20px;
    }
    pre {
        background-color: #eee;
        padding: 15px;
        white-space: pre-wrap; /* å…è®¸å†…å®¹è‡ªåŠ¨æ¢è¡Œ */
        border-radius: 5px;
    }
    /* èŠå¤©è¾“å…¥åŒºæ ·å¼ */
    .chat-input {
        padding-top: 20px;
        border-top: 1px solid #eee;
    }
</style>

<div id="learning-container">

    <div id="sidebar">
        <h2>ğŸ“š å­¦ä¹ è®¡åˆ’</h2>
        <nav>
            {% for item in learning_plan %}
                {% with current_id=learning_content.module_info.id %}
                
                <div class="module-item 
                    {% if item.id == current_id %}current{% endif %}
                    {% if item.status == 'completed' %}completed{% endif %}
                ">
                    <a href="{% url 'chat' conversation_id=conversation_id %}?module_id={{ item.id }}">
                        [{{ item.id }}] {{ item.title }}
                        {% if item.status == 'completed' %} (âœ”) {% endif %}
                    </a>
                </div>
                {% endwith %}
            {% empty %}
                <p>å­¦ä¹ è®¡åˆ’å°šæœªåŠ è½½ã€‚</p>
            {% endfor %}
        </nav>
    </div>

    <div id="main-area">
        
        <div id="learning-content-display">
            {% with info=learning_content.module_info %}
                {% if info.title %}
                    <h1>{{ info.title }}</h1>
                    <p>æ¨¡å—ID: <strong>{{ info.id }}</strong></p>
                    <hr>
                    
                    <h2>ğŸ“– è¯¾ç¨‹å†…å®¹</h2>
                    <div class="content-body">
                        <pre>{{ learning_content.content }}</pre>
                    </div>
                    
                    <h2>ğŸ“ è¯¾åä¹ é¢˜</h2>
                    <div class="exercise-body">
                        <pre>{{ learning_content.exercise }}</pre>
                    </div>
                {% else %}
                    <h1>æ¬¢è¿</h1>
                    <p>è¯·ç‚¹å‡»å·¦ä¾§ç›®å½•å¼€å§‹å­¦ä¹ ã€‚</p>
                {% endif %}
            {% endwith %}
        </div>

        <div class="chat-input">
            <form method="POST" action="{% url 'chat' conversation_id=conversation_id %}?module_id={{ learning_content.module_info.id }}">
                {% csrf_token %} 
                
                <input type="hidden" name="current_module_id" value="{{ learning_content.module_info.id|default:'' }}">
                
                <button name="action" value="next" type="submit">ä¸‹ä¸€è¯¾ / ç»§ç»­å­¦ä¹ </button>
                
                <button name="action" value="answer" type="submit">æŸ¥çœ‹ä¹ é¢˜ç­”æ¡ˆ</button>
                
                <button type="button" id="btnC">ç­”ç–‘</button>

                <div id="customInputContainer" style="display: none; margin-top: 15px;">
                    <label for="questionInput">è¾“å…¥é—®é¢˜ï¼š</label>
                    <input type="text" name="a-question" id="questionInput" placeholder="è¾“å…¥ä½ æƒ³é—®çš„é—®é¢˜">
                    <button name="action" value="Q&A" type="submit">æäº¤é—®é¢˜</button>
                </div>
            </form>
        </div>
    </div>
</div>


<script>
    // JavaScript for toggling the Q&A input field
    document.addEventListener('DOMContentLoaded', function() {
        const btnC = document.getElementById('btnC');
        const customContainer = document.getElementById('customInputContainer');

        if (btnC && customContainer) {
            btnC.addEventListener('click', function() {
                // åˆ‡æ¢è¾“å…¥æ¡†çš„æ˜¾ç¤ºçŠ¶æ€
                if (customContainer.style.display === 'none' || customContainer.style.display === '') {
                    customContainer.style.display = 'block';
                } else {
                    customContainer.style.display = 'none';
                }
            });
        }
    });
</script>

{% endblock %}